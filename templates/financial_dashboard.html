{% extends "base.html" %}

{% block content %}
<div class="topbar">
    <h1>Financial Dashboard</h1>
</div>

<div class="grid-4">
    <div class="card">
        <div>Total Fuel Cost</div>
        <div class="metric-value">{{ total_fuel_cost }}</div>
    </div>
    <div class="card">
        <div>Total Maintenance Cost</div>
        <div class="metric-value">{{ total_maintenance_cost }}</div>
    </div>
    <div class="card">
        <div>Total Operational Cost</div>
        <div class="metric-value">{{ total_operational_cost }}</div>
    </div>
    <div class="card">
        <div>Completed Trips</div>
        <div class="metric-value">{{ completed_trip_count }}</div>
    </div>
</div>

<div class="form-card mt-14">
    <h3>Add Fuel Log</h3>
    <form method="post" class="form-grid mt-10">
        <div class="input-group">
            <label>Vehicle</label>
            <select name="vehicle_id" required>
                <option value="">Select vehicle</option>
                {% for vehicle in vehicles %}
                    <option value="{{ vehicle.id }}">{{ vehicle.license_plate }}</option>
                {% endfor %}
            </select>
        </div>
        <div class="input-group">
            <label>Liters</label>
            <input type="number" step="0.01" min="0.01" name="liters" required>
        </div>
        <div class="input-group">
            <label>Cost</label>
            <input type="number" step="0.01" min="0" name="cost" required>
        </div>
        <div class="input-group">
            <label>Date</label>
            <input type="date" name="date" required>
        </div>
        <div class="input-group justify-end">
            <label>&nbsp;</label>
            <button type="submit">Add Fuel Log</button>
        </div>
    </form>
</div>

<div class="table-wrap mt-14">
    <table>
        <thead>
        <tr>
            <th>Vehicle</th>
            <th>Model</th>
            <th>Fuel Cost</th>
            <th>Maintenance Cost</th>
            <th>Operational Cost</th>
            <th>Completed Trips</th>
            <th>Cost per Trip</th>
        </tr>
        </thead>
        <tbody>
        {% for row in cost_rows %}
            <tr>
                <td>{{ row.license_plate }}</td>
                <td>{{ row.model_name }}</td>
                <td>{{ row.total_fuel_cost }}</td>
                <td>{{ row.total_maintenance_cost }}</td>
                <td>{{ row.total_operational_cost }}</td>
                <td>{{ row.completed_trips }}</td>
                <td>{% if row.cost_per_trip is not none %}{{ row.cost_per_trip }}{% else %}N/A{% endif %}</td>
            </tr>
        {% else %}
            <tr><td colspan="7">No vehicles found.</td></tr>
        {% endfor %}
        </tbody>
    </table>
</div>

<div class="row">
    <div class="table-wrap">
        <table>
            <thead>
            <tr>
                <th colspan="5">Completed Trips</th>
            </tr>
            <tr>
                <th>ID</th>
                <th>Vehicle</th>
                <th>Driver</th>
                <th>Route</th>
                <th>Cargo</th>
            </tr>
            </thead>
            <tbody>
            {% for trip in completed_trips %}
                <tr>
                    <td>#{{ trip.id }}</td>
                    <td>{{ trip.license_plate }}</td>
                    <td>{{ trip.driver_name }}</td>
                    <td>{{ trip.origin }} â†’ {{ trip.destination }}</td>
                    <td>{{ trip.cargo_weight }} kg</td>
                </tr>
            {% else %}
                <tr><td colspan="5">No completed trips yet.</td></tr>
            {% endfor %}
            </tbody>
        </table>
    </div>

    <div class="table-wrap">
        <table>
            <thead>
            <tr>
                <th colspan="4">Recent Maintenance Logs</th>
            </tr>
            <tr>
                <th>ID</th>
                <th>Vehicle</th>
                <th>Cost</th>
                <th>Date</th>
            </tr>
            </thead>
            <tbody>
            {% for log in maintenance_recent %}
                <tr>
                    <td>#{{ log.id }}</td>
                    <td>{{ log.license_plate }}</td>
                    <td>{{ log.cost }}</td>
                    <td>{{ log.date }}</td>
                </tr>
            {% else %}
                <tr><td colspan="4">No maintenance logs yet.</td></tr>
            {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% endblock %}
